trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  imageName: 'Test'
  dockerfilePath: './proiectING/Dockerfile'

stages:
- stage: BuildandPushDockerImage
  jobs:
  - job: BuildandPush
    displayName: BuildandPush Docker Image
    steps:
    - task: Docker@2
      displayName: BuildandPush Docker image
      inputs:
        command: buildAndPush
        dockerfile: $(dockerfilePath)
        containerRegistry: testAcrMara
        repository: proiectING
        tags: latest

- stage: CreateContainer
  jobs:
  - job: Create
    displayName: Create Container
    steps:
    - task: AzureKeyVault@2
      inputs:
        azureSubscription: 'Azure subscription 1(39f28949-f9b1-4a5f-aeed-fc0f1de6c497)'
        KeyVaultName: 'INGprojectVault'
        SecretsFilter: '*'
        RunAsPreJob: false
#     - task: AzureCLI@2
#       inputs:
#         azureSubscription: 'Azure subscription 1(39f28949-f9b1-4a5f-aeed-fc0f1de6c497)'
#         scriptType: 'pscore'
#         scriptLocation: 'inlineScript'
#         inlineScript: az container create -g resourceGroup-test --name test --image testacrmara.azurecr.io/proiectING:latest --cpu 1 --memory 1 --registry-login-server testacrmara.azurecr.io --registry-username $(User) --registry-password $(Password) --ports 5000